{"version":3,"sources":["node_modules/browser-pack/_prelude.js","index.ts"],"names":[],"mappings":"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","file":"rectangle-scan.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","export class RectCheck {\r\n  public ops: any = { maxB: 230, minB: 25, minEdge: 200, minCov: 50, scaleFactor: 0.5, searchWidth: 35 }\r\n  sobelX = [-1, 0, 1, -2, 0, 2, -1, 0, 1]\r\n  sobelY = [-1, -2, -1, 0, 0, 0, 1, 2, 1]\r\n  blur = [1, 1, 1, 1, 1, 1, 1, 1, 1]\r\n\r\n  constructor(ops: any = {}) {\r\n    for (let i in ops) this.ops[i] = ops[i]\r\n  }\r\n\r\n  public check(image: HTMLImageElement, x: number, y: number, w: number, h: number) {\r\n    const canvas = document.createElement('canvas')\r\n    const ctx = canvas.getContext('2d')\r\n    const width = image.clientWidth, height = image.clientHeight\r\n    canvas.width = width * this.ops.scaleFactor\r\n    canvas.height = height * this.ops.scaleFactor\r\n    const sh = this.ops.searchWidth\r\n    const frame = {\r\n      top: [x + sh / 2, y - sh / 2, w - sh, sh],\r\n      bottom: [x + sh / 2, y + h - sh / 2, w - sh, sh],\r\n      left: [x - sh / 2, y + sh / 2, sh, h - sh],\r\n      right: [x + w - sh / 2, y + sh / 2, sh, h - sh],\r\n    }\r\n\r\n    for (let i in frame) frame[i] = frame[i].map((f: number) => Math.round(f * this.ops.scaleFactor))\r\n    ctx.drawImage(image, 0, 0, canvas.width, canvas.height)\r\n\r\n    return this.checkCoverage(this.getEdges(ctx, frame.top, this.sobelY), frame.top[2], frame.top[2], (i: number, w: number) => i % w) > this.ops.minEdge &&\r\n      this.checkCoverage(this.getEdges(ctx, frame.bottom, this.sobelY), frame.bottom[2], frame.bottom[2], (i: number, w: number) => i % w) > this.ops.minEdge &&\r\n      this.checkCoverage(this.getEdges(ctx, frame.left, this.sobelX), frame.left[2], frame.left[3], (i: number, w: number) => Math.floor(i / w)) > this.ops.minEdge &&\r\n      this.checkCoverage(this.getEdges(ctx, frame.right, this.sobelX), frame.right[2], frame.left[3], (i: number, w: number) => Math.floor(i / w)) > this.ops.minEdge\r\n  }\r\n\r\n  private getEdges = (ctx: CanvasRenderingContext2D, box: number[], kernel: any) => {\r\n    let data = ctx.getImageData(box[0], box[1], box[2], box[3]).data\r\n    let pixels: number[] = [], max = this.ops.maxB, min = this.ops.minB\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      let v = (data[i] + data[i + 1] + data[i + 2]) / 3\r\n      pixels.push(v)\r\n      if (v < max) max = v\r\n      if (v > min) min = v\r\n    }\r\n    return this.blurImage(pixels, box[2]).map((p, i) => {\r\n      let v = Math.abs(Math.floor(this.convolute(pixels, i, box[2], kernel)))\r\n      if (isNaN(v) || v === Infinity || v === -Infinity) return 0\r\n      return v\r\n    })\r\n  }\r\n\r\n  private checkCoverage = (data: number[], width: number, length: number, combinationFunc: Function) => {\r\n    let coverage: number[] = []\r\n    for (let i = 0; i < data.length; i++) {\r\n      let x = combinationFunc(i, width)\r\n      let v = data[i] > this.ops.minCov ? 1 : 0\r\n      coverage[x] = coverage[x] ? coverage[x] + v : v\r\n    }\r\n    return 100 / length * coverage.reduce((t: number, v: number) => t + v)\r\n  }\r\n\r\n  private blurImage = (pixels: number[], width: number): number[] => pixels.map((p, i) => Math.floor(this.convolute(pixels, i, width, this.blur) / 9))\r\n\r\n  private convolute = (pixels: number[], index: number, width: number, pattern: number[]) => {\r\n    return pixels[(index - 1) - width] * pattern[0] // top left\r\n      + pixels[index - width] * pattern[1] // top\r\n      + pixels[index - width] * pattern[2] // top right\r\n      + pixels[index - 1] * pattern[3] // left\r\n      + pixels[index] * pattern[4] // center\r\n      + pixels[index + 1] * pattern[5] // right\r\n      + pixels[(index - 1) + width] * pattern[6] // bottom left\r\n      + pixels[(index) + width] * pattern[7] // bottom\r\n      + pixels[(index + 1) + width] * pattern[8] // bottom right\r\n  }\r\n}\r\n\r\n(<any>window).RectCheck = RectCheck"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7O0lDQWEsUztBQU1YLHlCQUF5QjtBQUFBOztBQUFBLFlBQWIsR0FBYSx1RUFBRixFQUFFOztBQUFBOztBQUxsQixhQUFBLEdBQUEsR0FBVyxFQUFFLE1BQU0sR0FBUixFQUFhLE1BQU0sRUFBbkIsRUFBdUIsU0FBUyxHQUFoQyxFQUFxQyxRQUFRLEVBQTdDLEVBQWlELGFBQWEsR0FBOUQsRUFBbUUsYUFBYSxFQUFoRixFQUFYO0FBQ1AsYUFBQSxNQUFBLEdBQVMsQ0FBQyxDQUFDLENBQUYsRUFBSyxDQUFMLEVBQVEsQ0FBUixFQUFXLENBQUMsQ0FBWixFQUFlLENBQWYsRUFBa0IsQ0FBbEIsRUFBcUIsQ0FBQyxDQUF0QixFQUF5QixDQUF6QixFQUE0QixDQUE1QixDQUFUO0FBQ0EsYUFBQSxNQUFBLEdBQVMsQ0FBQyxDQUFDLENBQUYsRUFBSyxDQUFDLENBQU4sRUFBUyxDQUFDLENBQVYsRUFBYSxDQUFiLEVBQWdCLENBQWhCLEVBQW1CLENBQW5CLEVBQXNCLENBQXRCLEVBQXlCLENBQXpCLEVBQTRCLENBQTVCLENBQVQ7QUFDQSxhQUFBLElBQUEsR0FBTyxDQUFDLENBQUQsRUFBSSxDQUFKLEVBQU8sQ0FBUCxFQUFVLENBQVYsRUFBYSxDQUFiLEVBQWdCLENBQWhCLEVBQW1CLENBQW5CLEVBQXNCLENBQXRCLEVBQXlCLENBQXpCLENBQVA7QUE2QlEsYUFBQSxRQUFBLEdBQVcsVUFBQyxHQUFELEVBQWdDLEdBQWhDLEVBQStDLE1BQS9DLEVBQThEO0FBQy9FLGdCQUFJLE9BQU8sSUFBSSxZQUFKLENBQWlCLElBQUksQ0FBSixDQUFqQixFQUF5QixJQUFJLENBQUosQ0FBekIsRUFBaUMsSUFBSSxDQUFKLENBQWpDLEVBQXlDLElBQUksQ0FBSixDQUF6QyxFQUFpRCxJQUE1RDtBQUNBLGdCQUFJLFNBQW1C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RSxNQUFNLElBQU4sQ0FBVyxDQUFYLENBQWhFLEVBQStFLE1BQU0sSUFBTixDQUFXLENBQVgsQ0FBL0UsRUFBOEYsVUFBQyxDQUFELEVBQVksQ0FBWjtBQUFBLHVCQUEwQixLQUFLLEtBQUwsQ0FBVyxJQUFJLENBQWYsQ0FBMUI7QUFBQSxhQUE5RixJQUE2SSxLQUFLLEdBQUwsQ0FBUyxPQUZqSixJQUdMLEtBQUssYUFBTCxDQUFtQixLQUFLLFFBQUwsQ0FBYyxHQUFkLEVBQW1CLE1BQU0sS0FBekIsRUFBZ0MsS0FBSyxNQUFyQyxDQUFuQixFQUFpRSxNQUFNLEtBQU4sQ0FBWSxDQUFaLENBQWpFLEVBQWlGLE1BQU0sSUFBTixDQUFXLENBQVgsQ0FBakYsRUFBZ0csVUFBQyxDQUFELEVBQVksQ0FBWjtBQUFBLHVCQUEwQixLQUFLLEtBQUwsQ0FBVyxJQUFJLENBQWYsQ0FBMUI7QUFBQSxhQUFoRyxJQUErSSxLQUFLLEdBQUwsQ0FBUyxPQUgxSjtBQUlEOzs7Ozs7QUEvQkgsUUFBQSxTQUFBLEdBQUEsU0FBQTtBQTBFTSxPQUFRLFNBQVIsR0FBb0IsU0FBcEIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJleHBvcnQgY2xhc3MgUmVjdENoZWNrIHtcclxuICBwdWJsaWMgb3BzOiBhbnkgPSB7IG1heEI6IDIzMCwgbWluQjogMjUsIG1pbkVkZ2U6IDIwMCwgbWluQ292OiA1MCwgc2NhbGVGYWN0b3I6IDAuNSwgc2VhcmNoV2lkdGg6IDM1IH1cclxuICBzb2JlbFggPSBbLTEsIDAsIDEsIC0yLCAwLCAyLCAtMSwgMCwgMV1cclxuICBzb2JlbFkgPSBbLTEsIC0yLCAtMSwgMCwgMCwgMCwgMSwgMiwgMV1cclxuICBibHVyID0gWzEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdXHJcblxyXG4gIGNvbnN0cnVjdG9yKG9wczogYW55ID0ge30pIHtcclxuICAgIGZvciAobGV0IGkgaW4gb3BzKSB0aGlzLm9wc1tpXSA9IG9wc1tpXVxyXG4gIH1cclxuXHJcbiAgcHVibGljIGNoZWNrKGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50LCB4OiBudW1iZXIsIHk6IG51bWJlciwgdzogbnVtYmVyLCBoOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpXHJcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKVxyXG4gICAgY29uc3Qgd2lkdGggPSBpbWFnZS5jbGllbnRXaWR0aCwgaGVpZ2h0ID0gaW1hZ2UuY2xpZW50SGVpZ2h0XHJcbiAgICBjYW52YXMud2lkdGggPSB3aWR0aCAqIHRoaXMub3BzLnNjYWxlRmFjdG9yXHJcbiAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0ICogdGhpcy5vcHMuc2NhbGVGYWN0b3JcclxuICAgIGNvbnN0IHNoID0gdGhpcy5vcHMuc2VhcmNoV2lkdGhcclxuICAgIGNvbnN0IGZyYW1lID0ge1xyXG4gICAgICB0b3A6IFt4ICsgc2ggLyAyLCB5IC0gc2ggLyAyLCB3IC0gc2gsIHNoXSxcclxuICAgICAgYm90dG9tOiBbeCArIHNoIC8gMiwgeSArIGggLSBzaCAvIDIsIHcgLSBzaCwgc2hdLFxyXG4gICAgICBsZWZ0OiBbeCAtIHNoIC8gMiwgeSArIHNoIC8gMiwgc2gsIGggLSBzaF0sXHJcbiAgICAgIHJpZ2h0OiBbeCArIHcgLSBzaCAvIDIsIHkgKyBzaCAvIDIsIHNoLCBoIC0gc2hdLFxyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IGkgaW4gZnJhbWUpIGZyYW1lW2ldID0gZnJhbWVbaV0ubWFwKChmOiBudW1iZXIpID0+IE1hdGgucm91bmQoZiAqIHRoaXMub3BzLnNjYWxlRmFjdG9yKSlcclxuICAgIGN0eC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodClcclxuXHJcbiAgICByZXR1cm4gdGhpcy5jaGVja0NvdmVyYWdlKHRoaXMuZ2V0RWRnZXMoY3R4LCBmcmFtZS50b3AsIHRoaXMuc29iZWxZKSwgZnJhbWUudG9wWzJdLCBmcmFtZS50b3BbMl0sIChpOiBudW1iZXIsIHc6IG51bWJlcikgPT4gaSAlIHcpID4gdGhpcy5vcHMubWluRWRnZSAmJlxyXG4gICAgICB0aGlzLmNoZWNrQ292ZXJhZ2UodGhpcy5nZXRFZGdlcyhjdHgsIGZyYW1lLmJvdHRvbSwgdGhpcy5zb2JlbFkpLCBmcmFtZS5ib3R0b21bMl0sIGZyYW1lLmJvdHRvbVsyXSwgKGk6IG51bWJlciwgdzogbnVtYmVyKSA9PiBpICUgdykgPiB0aGlzLm9wcy5taW5FZGdlICYmXHJcbiAgICAgIHRoaXMuY2hlY2tDb3ZlcmFnZSh0aGlzLmdldEVkZ2VzKGN0eCwgZnJhbWUubGVmdCwgdGhpcy5zb2JlbFgpLCBmcmFtZS5sZWZ0WzJdLCBmcmFtZS5sZWZ0WzNdLCAoaTogbnVtYmVyLCB3OiBudW1iZXIpID0+IE1hdGguZmxvb3IoaSAvIHcpKSA+IHRoaXMub3BzLm1pbkVkZ2UgJiZcclxuICAgICAgdGhpcy5jaGVja0NvdmVyYWdlKHRoaXMuZ2V0RWRnZXMoY3R4LCBmcmFtZS5yaWdodCwgdGhpcy5zb2JlbFgpLCBmcmFtZS5yaWdodFsyXSwgZnJhbWUubGVmdFszXSwgKGk6IG51bWJlciwgdzogbnVtYmVyKSA9PiBNYXRoLmZsb29yKGkgLyB3KSkgPiB0aGlzLm9wcy5taW5FZGdlXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldEVkZ2VzID0gKGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBib3g6IG51bWJlcltdLCBrZXJuZWw6IGFueSkgPT4ge1xyXG4gICAgbGV0IGRhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKGJveFswXSwgYm94WzFdLCBib3hbMl0sIGJveFszXSkuZGF0YVxyXG4gICAgbGV0IHBpeGVsczogbnVtYmVyW10gPSBbXSwgbWF4ID0gdGhpcy5vcHMubWF4QiwgbWluID0gdGhpcy5vcHMubWluQlxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7XHJcbiAgICAgIGxldCB2ID0gKGRhdGFbaV0gKyBkYXRhW2kgKyAxXSArIGRhdGFbaSArIDJdKSAvIDNcclxuICAgICAgcGl4ZWxzLnB1c2godilcclxuICAgICAgaWYgKHYgPCBtYXgpIG1heCA9IHZcclxuICAgICAgaWYgKHYgPiBtaW4pIG1pbiA9IHZcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmJsdXJJbWFnZShwaXhlbHMsIGJveFsyXSkubWFwKChwLCBpKSA9PiB7XHJcbiAgICAgIGxldCB2ID0gTWF0aC5hYnMoTWF0aC5mbG9vcih0aGlzLmNvbnZvbHV0ZShwaXhlbHMsIGksIGJveFsyXSwga2VybmVsKSkpXHJcbiAgICAgIGlmIChpc05hTih2KSB8fCB2ID09PSBJbmZpbml0eSB8fCB2ID09PSAtSW5maW5pdHkpIHJldHVybiAwXHJcbiAgICAgIHJldHVybiB2XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjaGVja0NvdmVyYWdlID0gKGRhdGE6IG51bWJlcltdLCB3aWR0aDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgY29tYmluYXRpb25GdW5jOiBGdW5jdGlvbikgPT4ge1xyXG4gICAgbGV0IGNvdmVyYWdlOiBudW1iZXJbXSA9IFtdXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgbGV0IHggPSBjb21iaW5hdGlvbkZ1bmMoaSwgd2lkdGgpXHJcbiAgICAgIGxldCB2ID0gZGF0YVtpXSA+IHRoaXMub3BzLm1pbkNvdiA/IDEgOiAwXHJcbiAgICAgIGNvdmVyYWdlW3hdID0gY292ZXJhZ2VbeF0gPyBjb3ZlcmFnZVt4XSArIHYgOiB2XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMTAwIC8gbGVuZ3RoICogY292ZXJhZ2UucmVkdWNlKCh0OiBudW1iZXIsIHY6IG51bWJlcikgPT4gdCArIHYpXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGJsdXJJbWFnZSA9IChwaXhlbHM6IG51bWJlcltdLCB3aWR0aDogbnVtYmVyKTogbnVtYmVyW10gPT4gcGl4ZWxzLm1hcCgocCwgaSkgPT4gTWF0aC5mbG9vcih0aGlzLmNvbnZvbHV0ZShwaXhlbHMsIGksIHdpZHRoLCB0aGlzLmJsdXIpIC8gOSkpXHJcblxyXG4gIHByaXZhdGUgY29udm9sdXRlID0gKHBpeGVsczogbnVtYmVyW10sIGluZGV4OiBudW1iZXIsIHdpZHRoOiBudW1iZXIsIHBhdHRlcm46IG51bWJlcltdKSA9PiB7XHJcbiAgICByZXR1cm4gcGl4ZWxzWyhpbmRleCAtIDEpIC0gd2lkdGhdICogcGF0dGVyblswXSAvLyB0b3AgbGVmdFxyXG4gICAgICArIHBpeGVsc1tpbmRleCAtIHdpZHRoXSAqIHBhdHRlcm5bMV0gLy8gdG9wXHJcbiAgICAgICsgcGl4ZWxzW2luZGV4IC0gd2lkdGhdICogcGF0dGVyblsyXSAvLyB0b3AgcmlnaHRcclxuICAgICAgKyBwaXhlbHNbaW5kZXggLSAxXSAqIHBhdHRlcm5bM10gLy8gbGVmdFxyXG4gICAgICArIHBpeGVsc1tpbmRleF0gKiBwYXR0ZXJuWzRdIC8vIGNlbnRlclxyXG4gICAgICArIHBpeGVsc1tpbmRleCArIDFdICogcGF0dGVybls1XSAvLyByaWdodFxyXG4gICAgICArIHBpeGVsc1soaW5kZXggLSAxKSArIHdpZHRoXSAqIHBhdHRlcm5bNl0gLy8gYm90dG9tIGxlZnRcclxuICAgICAgKyBwaXhlbHNbKGluZGV4KSArIHdpZHRoXSAqIHBhdHRlcm5bN10gLy8gYm90dG9tXHJcbiAgICAgICsgcGl4ZWxzWyhpbmRleCArIDEpICsgd2lkdGhdICogcGF0dGVybls4XSAvLyBib3R0b20gcmlnaHRcclxuICB9XHJcbn1cclxuXHJcbig8YW55PndpbmRvdykuUmVjdENoZWNrID0gUmVjdENoZWNrIl19"}