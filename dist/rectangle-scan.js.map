{"version":3,"sources":["node_modules/browser-pack/_prelude.js","index.ts"],"names":[],"mappings":"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","file":"rectangle-scan.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","export class RectCheck {\r\n  public ops: any = { maxBrightness: 230, minBrightness: 25, edgeThreshhold: 250, minContrast: 80, scale: 0.5, searchWidth: 30 }\r\n  sobelX = [-1, 0, 1, -2, 0, 2, -1, 0, 1]\r\n  sobelY = [-1, -2, -1, 0, 0, 0, 1, 2, 1]\r\n  blur = [1, 1, 1, 1, 1, 1, 1, 1, 1]\r\n\r\n  constructor(ops: any = {}) {\r\n    for (let i in ops) this.ops[i] = ops[i]\r\n  }\r\n\r\n  public check(image: HTMLImageElement, x: number, y: number, w: number, h: number) {\r\n    const canvas = document.createElement('canvas')\r\n    const ctx = canvas.getContext('2d')\r\n    const width = image.clientWidth, height = image.clientHeight\r\n    canvas.width = width * this.ops.scale\r\n    canvas.height = height * this.ops.scale\r\n    const sh = this.ops.searchWidth\r\n    const frame = {\r\n      top: [x + sh / 2, y - sh / 2, w - sh, sh],\r\n      bottom: [x + sh / 2, y + h - sh / 2, w - sh, sh],\r\n      left: [x - sh / 2, y + sh / 2, sh, h - sh],\r\n      right: [x + w - sh / 2, y + sh / 2, sh, h - sh],\r\n    }\r\n\r\n    for (let i in frame) frame[i] = frame[i].map((f: number) => Math.round(f * this.ops.scale))\r\n    ctx.drawImage(image, 0, 0, canvas.width, canvas.height)\r\n\r\n    return this.checkCoverage(this.getEdges(ctx, frame.top, this.sobelY), frame.top[2], frame.top[2], (i: number, w: number) => i % w) > this.ops.edgeThreshhold &&\r\n      this.checkCoverage(this.getEdges(ctx, frame.bottom, this.sobelY), frame.bottom[2], frame.bottom[2], (i: number, w: number) => i % w) > this.ops.edgeThreshhold &&\r\n      this.checkCoverage(this.getEdges(ctx, frame.left, this.sobelX), frame.left[2], frame.left[3], (i: number, w: number) => Math.floor(i / w)) > this.ops.edgeThreshhold &&\r\n      this.checkCoverage(this.getEdges(ctx, frame.right, this.sobelX), frame.right[2], frame.left[3], (i: number, w: number) => Math.floor(i / w)) > this.ops.edgeThreshhold\r\n  }\r\n\r\n  private getEdges = (ctx: CanvasRenderingContext2D, box: number[], kernel: any) => {\r\n    let data = ctx.getImageData(box[0], box[1], box[2], box[3]).data\r\n    let pixels: number[] = [], max = this.ops.maxBrightness, min = this.ops.minB\r\n    for (let i = 0; i < data.length; i += 4) {\r\n      let v = (data[i] + data[i + 1] + data[i + 2]) / 3\r\n      pixels.push(v)\r\n      if (v < max) max = v\r\n      if (v > min) min = v\r\n    }\r\n    return this.blurImage(pixels, box[2]).map((p, i) => {\r\n      let v = Math.abs(Math.floor(this.convolute(pixels, i, box[2], kernel)))\r\n      if (isNaN(v) || v === Infinity || v === -Infinity) return 0\r\n      return v\r\n    })\r\n  }\r\n\r\n  private checkCoverage = (data: number[], width: number, length: number, combinationFunc: Function) => {\r\n    let coverage: number[] = []\r\n    for (let i = 0; i < data.length; i++) {\r\n      let x = combinationFunc(i, width)\r\n      let v = data[i] > this.ops.minContrast ? 1 : 0\r\n      coverage[x] = coverage[x] ? coverage[x] + v : v\r\n    }\r\n    return 100 / length * coverage.reduce((t: number, v: number) => t + v)\r\n  }\r\n\r\n  private blurImage = (pixels: number[], width: number): number[] => pixels.map((p, i) => Math.floor(this.convolute(pixels, i, width, this.blur) / 9))\r\n\r\n  private convolute = (pixels: number[], index: number, width: number, pattern: number[]) => {\r\n    return pixels[(index - 1) - width] * pattern[0] // top left\r\n      + pixels[index - width] * pattern[1] // top\r\n      + pixels[index - width] * pattern[2] // top right\r\n      + pixels[index - 1] * pattern[3] // left\r\n      + pixels[index] * pattern[4] // center\r\n      + pixels[index + 1] * pattern[5] // right\r\n      + pixels[(index - 1) + width] * pattern[6] // bottom left\r\n      + pixels[(index) + width] * pattern[7] // bottom\r\n      + pixels[(index + 1) + width] * pattern[8] // bottom right\r\n  }\r\n}\r\n\r\n(<any>window).RectCheck = RectCheck"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7O0lDQWEsUztBQU1YLHlCQUF5QjtBQUFBOztBQUFBLFlBQWIsR0FBYSx1RUFBRixFQUFFOztBQUFBOztBQUxsQixhQUFBLEdBQUEsR0FBVyxFQUFFLGVBQWUsR0FBakIsRUFBc0IsZUFBZSxFQUFyQyxFQUF5QyxnQkFBZ0IsR0FBekQsRUFBOEQsYUFBYSxFQUEzRSxFQUErRSxPQUFPLEdBQXRGLEVBQTJGLGFBQWEsRUFBeEcsRUFBWDtBQUNQLGFBQUEsTUFBQSxHQUFTLENBQUMsQ0FBQyxDQUFGLEVBQUssQ0FBTCxFQUFRLENBQVIsRUFBVyxDQUFDLENBQVosRUFBZSxDQUFmLEVBQWtCLENBQWxCLEVBQXFCLENBQUMsQ0FBdEIsRUFBeUIsQ0FBekIsRUFBNEIsQ0FBNUIsQ0FBVDtBQUNBLGFBQUEsTUFBQSxHQUFTLENBQUMsQ0FBQyxDQUFGLEVBQUssQ0FBQyxDQUFOLEVBQVMsQ0FBQyxDQUFWLEVBQWEsQ0FBYixFQUFnQixDQUFoQixFQUFtQixDQUFuQixFQUFzQixDQUF0QixFQUF5QixDQUF6QixFQUE0QixDQUE1QixDQUFUO0FBQ0EsYUFBQSxJQUFBLEdBQU8sQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsRUFBVSxDQUFWLEVBQWEsQ0FBYixFQUFnQixDQUFoQixFQUFtQixDQUFuQixFQUFzQixDQUF0QixFQUF5QixDQUF6QixDQUFQO0FBNkJRLGFBQUEsUUFBQSxHQUFXLFVBQUMsR0FBRCxFQUFnQyxHQUFoQyxFQUErQyxNQUEvQyxFQUE4RDtBQUMvRSxnQkFBSSxPQUFPLElBQUksWUFBSixDQUFpQixJQUFJLENBQUosQ0FBakIsRUFBeUIsSUFBSSxDQUFKLENBQXpCLEVBQWlDLElBQUksQ0FBSixDQUFqQyxFQUF5QyxJQUFJLENBQUosQ0FBekMsRUFBaUQsSUFBNUQ7QUFDQSxnQkFBSSxT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RUFBZ0UsTUFBTSxJQUFOLENBQVcsQ0FBWCxDQUFoRSxFQUErRSxNQUFNLElBQU4sQ0FBVyxDQUFYLENBQS9FLEVBQThGLFVBQUMsQ0FBRCxFQUFZLENBQVo7QUFBQSx1QkFBMEIsS0FBSyxLQUFMLENBQVcsSUFBSSxDQUFmLENBQTFCO0FBQUEsYUFBOUYsSUFBNkksS0FBSyxHQUFMLENBQVMsY0FGakosSUFHTCxLQUFLLGFBQUwsQ0FBbUIsS0FBSyxRQUFMLENBQWMsR0FBZCxFQUFtQixNQUFNLEtBQXpCLEVBQWdDLEtBQUssTUFBckMsQ0FBbkIsRUFBaUUsTUFBTSxLQUFOLENBQVksQ0FBWixDQUFqRSxFQUFpRixNQUFNLElBQU4sQ0FBVyxDQUFYLENBQWpGLEVBQWdHLFVBQUMsQ0FBRCxFQUFZLENBQVo7QUFBQSx1QkFBMEIsS0FBSyxLQUFMLENBQVcsSUFBSSxDQUFmLENBQTFCO0FBQUEsYUFBaEcsSUFBK0ksS0FBSyxHQUFMLENBQVMsY0FIMUo7QUFJRDs7Ozs7O0FBL0JILFFBQUEsU0FBQSxHQUFBLFNBQUE7QUEwRU0sT0FBUSxTQUFSLEdBQW9CLFNBQXBCIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiZXhwb3J0IGNsYXNzIFJlY3RDaGVjayB7XHJcbiAgcHVibGljIG9wczogYW55ID0geyBtYXhCcmlnaHRuZXNzOiAyMzAsIG1pbkJyaWdodG5lc3M6IDI1LCBlZGdlVGhyZXNoaG9sZDogMjUwLCBtaW5Db250cmFzdDogODAsIHNjYWxlOiAwLjUsIHNlYXJjaFdpZHRoOiAzMCB9XHJcbiAgc29iZWxYID0gWy0xLCAwLCAxLCAtMiwgMCwgMiwgLTEsIDAsIDFdXHJcbiAgc29iZWxZID0gWy0xLCAtMiwgLTEsIDAsIDAsIDAsIDEsIDIsIDFdXHJcbiAgYmx1ciA9IFsxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXVxyXG5cclxuICBjb25zdHJ1Y3RvcihvcHM6IGFueSA9IHt9KSB7XHJcbiAgICBmb3IgKGxldCBpIGluIG9wcykgdGhpcy5vcHNbaV0gPSBvcHNbaV1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBjaGVjayhpbWFnZTogSFRNTEltYWdlRWxlbWVudCwgeDogbnVtYmVyLCB5OiBudW1iZXIsIHc6IG51bWJlciwgaDogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKVxyXG4gICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJylcclxuICAgIGNvbnN0IHdpZHRoID0gaW1hZ2UuY2xpZW50V2lkdGgsIGhlaWdodCA9IGltYWdlLmNsaWVudEhlaWdodFxyXG4gICAgY2FudmFzLndpZHRoID0gd2lkdGggKiB0aGlzLm9wcy5zY2FsZVxyXG4gICAgY2FudmFzLmhlaWdodCA9IGhlaWdodCAqIHRoaXMub3BzLnNjYWxlXHJcbiAgICBjb25zdCBzaCA9IHRoaXMub3BzLnNlYXJjaFdpZHRoXHJcbiAgICBjb25zdCBmcmFtZSA9IHtcclxuICAgICAgdG9wOiBbeCArIHNoIC8gMiwgeSAtIHNoIC8gMiwgdyAtIHNoLCBzaF0sXHJcbiAgICAgIGJvdHRvbTogW3ggKyBzaCAvIDIsIHkgKyBoIC0gc2ggLyAyLCB3IC0gc2gsIHNoXSxcclxuICAgICAgbGVmdDogW3ggLSBzaCAvIDIsIHkgKyBzaCAvIDIsIHNoLCBoIC0gc2hdLFxyXG4gICAgICByaWdodDogW3ggKyB3IC0gc2ggLyAyLCB5ICsgc2ggLyAyLCBzaCwgaCAtIHNoXSxcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBpIGluIGZyYW1lKSBmcmFtZVtpXSA9IGZyYW1lW2ldLm1hcCgoZjogbnVtYmVyKSA9PiBNYXRoLnJvdW5kKGYgKiB0aGlzLm9wcy5zY2FsZSkpXHJcbiAgICBjdHguZHJhd0ltYWdlKGltYWdlLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpXHJcblxyXG4gICAgcmV0dXJuIHRoaXMuY2hlY2tDb3ZlcmFnZSh0aGlzLmdldEVkZ2VzKGN0eCwgZnJhbWUudG9wLCB0aGlzLnNvYmVsWSksIGZyYW1lLnRvcFsyXSwgZnJhbWUudG9wWzJdLCAoaTogbnVtYmVyLCB3OiBudW1iZXIpID0+IGkgJSB3KSA+IHRoaXMub3BzLmVkZ2VUaHJlc2hob2xkICYmXHJcbiAgICAgIHRoaXMuY2hlY2tDb3ZlcmFnZSh0aGlzLmdldEVkZ2VzKGN0eCwgZnJhbWUuYm90dG9tLCB0aGlzLnNvYmVsWSksIGZyYW1lLmJvdHRvbVsyXSwgZnJhbWUuYm90dG9tWzJdLCAoaTogbnVtYmVyLCB3OiBudW1iZXIpID0+IGkgJSB3KSA+IHRoaXMub3BzLmVkZ2VUaHJlc2hob2xkICYmXHJcbiAgICAgIHRoaXMuY2hlY2tDb3ZlcmFnZSh0aGlzLmdldEVkZ2VzKGN0eCwgZnJhbWUubGVmdCwgdGhpcy5zb2JlbFgpLCBmcmFtZS5sZWZ0WzJdLCBmcmFtZS5sZWZ0WzNdLCAoaTogbnVtYmVyLCB3OiBudW1iZXIpID0+IE1hdGguZmxvb3IoaSAvIHcpKSA+IHRoaXMub3BzLmVkZ2VUaHJlc2hob2xkICYmXHJcbiAgICAgIHRoaXMuY2hlY2tDb3ZlcmFnZSh0aGlzLmdldEVkZ2VzKGN0eCwgZnJhbWUucmlnaHQsIHRoaXMuc29iZWxYKSwgZnJhbWUucmlnaHRbMl0sIGZyYW1lLmxlZnRbM10sIChpOiBudW1iZXIsIHc6IG51bWJlcikgPT4gTWF0aC5mbG9vcihpIC8gdykpID4gdGhpcy5vcHMuZWRnZVRocmVzaGhvbGRcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0RWRnZXMgPSAoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIGJveDogbnVtYmVyW10sIGtlcm5lbDogYW55KSA9PiB7XHJcbiAgICBsZXQgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoYm94WzBdLCBib3hbMV0sIGJveFsyXSwgYm94WzNdKS5kYXRhXHJcbiAgICBsZXQgcGl4ZWxzOiBudW1iZXJbXSA9IFtdLCBtYXggPSB0aGlzLm9wcy5tYXhCcmlnaHRuZXNzLCBtaW4gPSB0aGlzLm9wcy5taW5CXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IDQpIHtcclxuICAgICAgbGV0IHYgPSAoZGF0YVtpXSArIGRhdGFbaSArIDFdICsgZGF0YVtpICsgMl0pIC8gM1xyXG4gICAgICBwaXhlbHMucHVzaCh2KVxyXG4gICAgICBpZiAodiA8IG1heCkgbWF4ID0gdlxyXG4gICAgICBpZiAodiA+IG1pbikgbWluID0gdlxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuYmx1ckltYWdlKHBpeGVscywgYm94WzJdKS5tYXAoKHAsIGkpID0+IHtcclxuICAgICAgbGV0IHYgPSBNYXRoLmFicyhNYXRoLmZsb29yKHRoaXMuY29udm9sdXRlKHBpeGVscywgaSwgYm94WzJdLCBrZXJuZWwpKSlcclxuICAgICAgaWYgKGlzTmFOKHYpIHx8IHYgPT09IEluZmluaXR5IHx8IHYgPT09IC1JbmZpbml0eSkgcmV0dXJuIDBcclxuICAgICAgcmV0dXJuIHZcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNoZWNrQ292ZXJhZ2UgPSAoZGF0YTogbnVtYmVyW10sIHdpZHRoOiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBjb21iaW5hdGlvbkZ1bmM6IEZ1bmN0aW9uKSA9PiB7XHJcbiAgICBsZXQgY292ZXJhZ2U6IG51bWJlcltdID0gW11cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xyXG4gICAgICBsZXQgeCA9IGNvbWJpbmF0aW9uRnVuYyhpLCB3aWR0aClcclxuICAgICAgbGV0IHYgPSBkYXRhW2ldID4gdGhpcy5vcHMubWluQ29udHJhc3QgPyAxIDogMFxyXG4gICAgICBjb3ZlcmFnZVt4XSA9IGNvdmVyYWdlW3hdID8gY292ZXJhZ2VbeF0gKyB2IDogdlxyXG4gICAgfVxyXG4gICAgcmV0dXJuIDEwMCAvIGxlbmd0aCAqIGNvdmVyYWdlLnJlZHVjZSgodDogbnVtYmVyLCB2OiBudW1iZXIpID0+IHQgKyB2KVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBibHVySW1hZ2UgPSAocGl4ZWxzOiBudW1iZXJbXSwgd2lkdGg6IG51bWJlcik6IG51bWJlcltdID0+IHBpeGVscy5tYXAoKHAsIGkpID0+IE1hdGguZmxvb3IodGhpcy5jb252b2x1dGUocGl4ZWxzLCBpLCB3aWR0aCwgdGhpcy5ibHVyKSAvIDkpKVxyXG5cclxuICBwcml2YXRlIGNvbnZvbHV0ZSA9IChwaXhlbHM6IG51bWJlcltdLCBpbmRleDogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBwYXR0ZXJuOiBudW1iZXJbXSkgPT4ge1xyXG4gICAgcmV0dXJuIHBpeGVsc1soaW5kZXggLSAxKSAtIHdpZHRoXSAqIHBhdHRlcm5bMF0gLy8gdG9wIGxlZnRcclxuICAgICAgKyBwaXhlbHNbaW5kZXggLSB3aWR0aF0gKiBwYXR0ZXJuWzFdIC8vIHRvcFxyXG4gICAgICArIHBpeGVsc1tpbmRleCAtIHdpZHRoXSAqIHBhdHRlcm5bMl0gLy8gdG9wIHJpZ2h0XHJcbiAgICAgICsgcGl4ZWxzW2luZGV4IC0gMV0gKiBwYXR0ZXJuWzNdIC8vIGxlZnRcclxuICAgICAgKyBwaXhlbHNbaW5kZXhdICogcGF0dGVybls0XSAvLyBjZW50ZXJcclxuICAgICAgKyBwaXhlbHNbaW5kZXggKyAxXSAqIHBhdHRlcm5bNV0gLy8gcmlnaHRcclxuICAgICAgKyBwaXhlbHNbKGluZGV4IC0gMSkgKyB3aWR0aF0gKiBwYXR0ZXJuWzZdIC8vIGJvdHRvbSBsZWZ0XHJcbiAgICAgICsgcGl4ZWxzWyhpbmRleCkgKyB3aWR0aF0gKiBwYXR0ZXJuWzddIC8vIGJvdHRvbVxyXG4gICAgICArIHBpeGVsc1soaW5kZXggKyAxKSArIHdpZHRoXSAqIHBhdHRlcm5bOF0gLy8gYm90dG9tIHJpZ2h0XHJcbiAgfVxyXG59XHJcblxyXG4oPGFueT53aW5kb3cpLlJlY3RDaGVjayA9IFJlY3RDaGVjayJdfQ=="}